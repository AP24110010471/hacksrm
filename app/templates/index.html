<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo-Intelligent Advisory</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Live Background Layer -->
    <div class="live-bg"></div>

    <div class="container">
        <header>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h1>üå± Geo-Intelligent Advisory</h1>
                    <p>Welcome, <strong>{{ user }}</strong>!</p>
                </div>
                <a href="/logout" class="btn-primary"
                    style="background:#e74c3c; text-decoration:none; font-size:0.9rem;">Logout</a>
            </div>
            <p style="text-align:center; color:#555;">Smart Farming Decisions based on Local Soil & Climate Data</p>
        </header>

        <main>
            <!-- Step 1: Location -->
            <section id="step1" class="card">
                <h2>1. Identify Location</h2>
                <div class="input-group">
                    <div style="flex: 1;">
                        <label>State & District:</label>
                        <input type="text" id="districtInput" placeholder="District (e.g. Guntur, Warangal)">
                    </div>
                    <div style="flex: 1;">
                        <label>Village Name (Optional):</label>
                        <input type="text" id="villageInput" placeholder="Village (e.g. Mangalagiri, Uppal)">
                    </div>
                    <button onclick="analyzeLocation()" class="btn-primary">Analyze Location</button>
                    <p id="locationError" class="error-msg"></p>
                </div>
                <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                    <em>Supported Villages: Mangalagiri, Uppal, Araku Valley, Kazipet, Bhimavaram, etc.</em>
                </p>
                <div id="locationResult" class="result-box hidden">
                    <!-- Live Weather Widget -->
                    <div class="weather-card">
                        <div class="weather-icon">üå¶Ô∏è</div>
                        <div style="flex: 1;">
                            <h3 style="margin:0">Live Weather</h3>
                            <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                                <div>
                                    <span id="tempDisplay" style="font-size: 2rem; font-weight: bold;">--¬∞C</span>
                                    <div id="weatherCondition" style="color: #555; font-weight: 600;">--</div>
                                </div>
                                <div style="text-align: right; font-size: 0.85rem; color: #666;">
                                    <div>Humidity: <span id="humidityDisplay">--</span>%</div>
                                    <div>Wind: <span id="windDisplay">--</span> km/h</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>
                    <p><strong>Detected Location:</strong> <span id="detectedLoc"></span></p>
                    <p><strong>Soil Type:</strong> <span id="soilType"></span></p>
                    <p><strong>Agro-Climatic Zone:</strong> <span id="climateZone"></span></p>
                </div>
            </section>

            <!-- Step 2: Crop Recommendation -->
            <section id="step2" class="card hidden">
                <h2>2. Crop Intelligence</h2>
                <div class="input-group">
                    <label>Select Season:</label>
                    <select id="seasonInput">
                        <option value="Kharif">Kharif (Monsoon)</option>
                        <option value="Rabi">Rabi (Winter)</option>
                        <option value="Zaid">Zaid (Summer)</option>
                    </select>
                    <button onclick="recommendCrops()" class="btn-primary">Find Suitable Crops</button>
                </div>
                <div id="cropResult" class="result-grid hidden">
                    <!-- Crops will be injected here -->
                </div>
            </section>

            <!-- Live Market Rate Section -->
            <section id="marketSection" class="card hidden" style="border-left: 4px solid #27ae60;">
                <h2>üíµ Live Market Rates</h2>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <p style="margin:0;">Current Price for <strong id="priceCropName"></strong></p>
                        <small id="marketLoc">at -- APMC</small>
                    </div>
                    <div style="text-align: right;">
                        <span id="priceValue" style="font-size: 1.5rem; font-weight: bold; color: #27ae60;">‚Çπ --</span>
                        <div id="priceTrend" style="font-size: 0.8srem; font-weight: bold;">--</div>
                    </div>
                </div>
            </section>

            <!-- Step 3: Yield Calculator -->
            <section id="step3a" class="card hidden" style="border-left: 4px solid #f1c40f;">
                <h2>3a. Yield Estimator</h2>
                <p>Estimate production for <strong id="yieldCropName"></strong></p>
                <div class="input-group">
                    <label>Area (Acres):</label>
                    <input type="number" id="yieldArea" value="1" onchange="calculateYield()">
                    <button onclick="calculateYield()" class="btn-primary" style="background-color: #f39c12;">Estimate
                        Yield</button>
                </div>
                <div id="yieldResult" class="hidden" style="margin-top: 15px; font-weight: bold; color: #d35400;">
                    Expected Yield: <span id="yieldValue"></span>
                </div>
            </section>

            <!-- Step 3b: Resource Calculator -->
            <section id="step3" class="card hidden">
                <h2>3b. Resource Calculator</h2>
                <div class="input-group">
                    <p>Selected Crop: <strong id="selectedCropName"></strong></p>
                    <label>Land Area (Acres):</label>
                    <input type="number" id="areaInput" value="1" min="0.1" step="0.1">
                    <button onclick="calculateResources()" class="btn-primary">Calculate Resources</button>
                </div>
                <div id="calcResult" class="result-box hidden">
                    <h3>üì¶ Resource Plan</h3>
                    <!-- Resource Output Container -->
                    <div id="resourceOutput"></div>

                    <h4>üìÖ Application Schedule</h4>
                    <!-- Schedule Output Container -->
                    <div id="scheduleOutput"></div>

                    <!-- Disease Alert Box -->
                    <div id="diseaseBox" class="disease-alert hidden">
                        <h4>‚ö†Ô∏è Disease Watch: <span id="diseaseName"></span></h4>
                        <p><strong>Risk:</strong> <span id="diseaseRisk"></span></p>
                        <p><strong>Remedy:</strong> <span id="diseaseRemedy"></span></p>
                    </div>

                    <div class="ai-box">
                        <h4>ü§ñ AI Explanation</h4>
                        <p id="aiExplanation"></p>
                    </div>

                    <!-- Add to History Button -->
                    <button onclick="addToHistory()" style="background:#5e35b1; margin-top:10px;" class="btn-primary">üíæ
                        Save this Plan to History</button>
                </div>
            </section>

            <!-- Step 4: Crop Disease Intelligence -->
            <section id="diseaseSection" class="card" style="border-left: 4px solid #e74c3c;">
                <h2>ü©∫ Crop Doctor (Disease Intelligence)</h2>
                <div class="input-group">
                    <p>Analyze potential infection risks for <strong id="diagnosisCropName">--</strong> based on current
                        weather.</p>
                    <button onclick="runDiseaseDiagnosis()" class="btn-primary"
                        style="background-color: #e74c3c;">Analyze Risk</button>
                    <!-- Visualizer Placeholder -->
                    <div id="diseaseVisualizer" class="hidden" style="margin-top:15px; text-align:center;"></div>
                </div>
            </section>

            <!-- Step 5: Farming History -->
            <section id="historySection" class="card">
                <h2>üìú Farming Journey (History)</h2>
                <div class="table-container">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Crop</th>
                                <th>Location</th>
                                <th>Yield Est.</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- History Rows -->
                        </tbody>
                    </table>
                </div>
                <button onclick="loadHistory()" class="btn-secondary" style="margin-top:10px;">Refresh History</button>
            </section>
        </main>
    </div>
    <script src="/static/script.js"></script>
</body>

</html>